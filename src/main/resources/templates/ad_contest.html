<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOB Î©îÏù∏ ÌéòÏù¥ÏßÄ</title>
    <link rel="stylesheet" href="/css/ad_contest.css">
</head>
<body>

<!-- Î©îÏù∏ Î∞∞ÎÑà -->
<section class="main-banner">
    <img src="/images/banner.png" alt="Î∞∞ÎÑà Ïù¥ÎØ∏ÏßÄ" class="banner-image">
</section>

<div class="content">

    <section class="contest-list">
        <div class="ohoh">
            <h2>Í≥µÎ™®Ï†Ñ</h2>
            <button class="deletebtn" id="delete-selected" type="submit" form="deleteForm">ÏÇ≠Ï†ú</button>
        </div>
        <hr>
        <div class="filter-wrapper">
            <div class="filter-container">
                <select id="sort-filter">
                    <option value="latest">ÏµúÏã†Ïàú</option>
                    <option value="popular">Ïù∏Í∏∞Ïàú</option>
                </select>

                <input type="date" id="start-date">
                <span>~</span>
                <input type="date" id="end-date">

                <div class="search-wrapper">
                    <button class="search-btn" id="searchicon">
                        <img src="/images/search-icon.png" alt="Í≤ÄÏÉâ">
                    </button>

                    <!-- Í≤ÄÏÉâÏ∞Ω (Ï≤òÏùåÏóî Ïà®Í≤®Ï†∏ ÏûàÏùå) -->
                    <div class="search-box" id="search-box">
                        <div class="search-header">
                            <input type="text" placeholder="ÌîÑÎ°úÏ†ùÌä∏ Í≤ÄÏÉâ..." id="search-input">
                            <button id="search-close">&times;</button>
                        </div>
                    </div>
                </div>

                <!-- ÌïÑÌÑ∞ Î≤ÑÌäº Ï∂îÍ∞Ä -->
                <button class="filter-btn" id="filtericon">
                    <img src="/images/filter.png" alt="ÌïÑÌÑ∞">
                </button>
            </div>

            <img src="/images/onlybob.png" id="bob">
        </div>

        <!-- ÌïÑÌÑ∞ÎßÅ Ï∞Ω -->
        <form method="get" action="/ad_contest">
        <div class="filter-box" id="filter-box">
            <div class="filter-tabs">
                <button class="filter-tab active" data-target="filter-who">Ï£ºÏµú</button>
                <button class="filter-tab" data-target="filter-type">Í≥µÎ™®Ï†Ñ Ïú†Ìòï</button>
                <button class="filter-tab" data-target="filter-lang">ÏΩîÎî© Ïñ∏Ïñ¥</button>
                <button class="filter-tab" data-target="filter-level">ÎÇúÏù¥ÎèÑ</button>
                <button class="filter-tab" data-target="filter-prize">ÏÉÅÍ∏à</button>
                <button class="filter-tab" data-target="filter-location">ÏßÄÏó≠</button>
            </div>

            <div class="filter-content">
                <div class="filter-category active" id="filter-who">
                    <button class="filter-option">Í∏∞ÏóÖ</button>
                    <button class="filter-option">Ïô∏Î∂Ä</button>
                </div>

                <div class="filter-category" id="filter-type">
                    <button class="filter-option">Ìï¥Ïª§ÌÜ§</button>
                    <button class="filter-option">ÏïåÍ≥†Î¶¨Ï¶ò</button>
                    <button class="filter-option">Ïò§ÌîàÏÜåÏä§</button>
                    <button class="filter-option">Ïï±</button>
                </div>

                <div class="filter-category" id="filter-lang">
                    <button class="filter-option">Python</button>
                    <button class="filter-option">JavaScript</button>
                    <button class="filter-option">Java</button>
                    <button class="filter-option">C++</button>
                    <button class="filter-option">Kotlin</button>
                    <button class="filter-option">Swift</button>
                    <button class="filter-option">SQL</button>
                    <button class="filter-option">React</button>
                    <button class="filter-option">Node</button>
                    <button class="filter-option">Í∏∞ÌÉÄ</button>
                </div>

                <div class="filter-category" id="filter-level">
                    <button class="filter-option">Ï¥àÍ∏â</button>
                    <button class="filter-option">Ï§ëÍ∏â</button>
                    <button class="filter-option">Í≥†Í∏â</button>
                </div>

                <div class="filter-category" id="filter-prize">
                    <button class="filter-option">100ÎßåÏõê Ïù¥Ìïò</button>
                    <button class="filter-option">100~500ÎßåÏõê</button>
                    <button class="filter-option">500ÎßåÏõê Ïù¥ÏÉÅ</button>
                </div>

                <div class="filter-category" id="filter-location">
                    <button class="filter-option">ÏÑúÏö∏</button>
                    <button class="filter-option">Í≤ΩÍ∏∞ÎèÑ</button>
                    <button class="filter-option">Ïù∏Ï≤ú</button>
                    <button class="filter-option">Î∂ÄÏÇ∞</button>
                    <button class="filter-option">ÎåÄÍµ¨</button>
                    <button class="filter-option">Ïù∏Ï≤ú</button>
                    <button class="filter-option">Í¥ëÏ£º</button>
                    <button class="filter-option">ÎåÄÏ†Ñ</button>
                    <button class="filter-option">Ïö∏ÏÇ∞</button>
                    <button class="filter-option">ÏÑ∏Ï¢Ö</button>
                    <button class="filter-option">Í∞ïÏõê</button>
                    <button class="filter-option">Ï∂©Î∂Å</button>
                    <button class="filter-option">Ï∂©ÎÇ®</button>
                    <button class="filter-option">Ï†ÑÎ∂Å</button>
                    <button class="filter-option">Ï†ÑÎÇ®</button>
                    <button class="filter-option">Í≤ΩÎ∂Å</button>
                    <button class="filter-option">Í≤ΩÎÇ®</button>
                    <button class="filter-option">Ï†úÏ£º</button>
                </div>

                <div class="selected-filters" id="selected-filters"></div>

                <button class="clear-filters" id="clear-filters">ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî</button>
                <div class="filter-buttons">
                    <button class="view-results">Í≤∞Í≥º Î≥¥Í∏∞</button>

                    <button class="close-filter" id="filter-close">ÌïÑÌÑ∞ Ï∞Ω Îã´Í∏∞</button>
                </div>
            </div>
        </div>
        </form>

        <form id="deleteForm" method="post" action="/admin/contest/delete" th:object="${contests}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <table class="contest-table">
            <thead>
            <tr>
                <th>Í≥µÎ™®Î™Ö</th>
                <th>Ï£ºÏµú</th>
                <th>ÎÇ®ÏùÄ Í∏∞Í∞Ñ</th>
                <th>ÏßÑÌñâ ÏùºÏ†ï</th>
                <th>ÌòÑÌô©</th>
                <th><input type="checkbox" id="select-all"></th>
            </tr>
            </thead>
            <tbody id="contest-body">
            <!-- Thymeleaf Î∞òÎ≥µÎ¨∏ÏúºÎ°ú ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Ï∂úÎ†• -->
            <tr th:each="contest : ${contests}">
                <td>
                    <a th:href="@{'/contest/' + ${contest.id}}" th:text="${contest.title}">Í≥µÎ™®Ï†Ñ Ï†úÎ™©</a>
                </td>
                <td th:text="${contest.organizer}">Ï£ºÏµú Í∏∞Í¥Ä</td>
                <td th:text="'D-' + ${contest.remainingDays}">D-5456</td>
                <td th:text="${contest.startDate} + ' ~ ' + ${contest.endDate}">2024.01.01 ~ 2024.06.30</td>
                <td th:text="${contest.status}">ÏßÑÌñâ Ï§ë</td>
                <td>
                    <input type="checkbox" class="contest-checkbox" name="idsToDelete" th:value="${contest.id}">
                </td> <!-- Ï≤¥ÌÅ¨Î∞ïÏä§ Ï∂îÍ∞Ä -->
            </tr>
            </tbody>
        </table>
        </form>
    </section>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        initializeSearchAndFilter();
    });

    function initializeSearchAndFilter() {
        console.log("üìå Í≤ÄÏÉâ & ÌïÑÌÑ∞ Í∏∞Îä• Îã§Ïãú ÌôúÏÑ±Ìôî");

        // üîç Í≤ÄÏÉâ Í∏∞Îä•
        document.addEventListener("click", function (event) {
            const searchIcon = document.getElementById("searchicon");
            const searchBox = document.getElementById("search-box");
            const searchClose = document.getElementById("search-close");

            if (event.target === searchIcon) {
                searchBox.classList.toggle("active");
            } else if (event.target === searchClose) {
                searchBox.classList.remove("active");
            }
        });

        // üéõÔ∏è ÌïÑÌÑ∞ Í∏∞Îä•
        document.addEventListener("click", function (event) {
            const filterIcon = document.getElementById("filtericon");
            const filterBox = document.getElementById("filter-box");
            const filterClose = document.getElementById("filter-close");

            if (event.target === filterIcon) {
                filterBox.classList.toggle("active");
            } else if (event.target === filterClose) {
                filterBox.classList.remove("active");
            }
        });

        // ‚úÖ ÌïÑÌÑ∞ ÏòµÏÖò ÏÑ†ÌÉù Í∏∞Îä•
        const selectedFilters = document.getElementById("selected-filters");
        const filterOptions = document.querySelectorAll(".filter-option");

        filterOptions.forEach(option => {
            option.addEventListener("click", function () {
                let existingFilter = document.querySelector(`.selected-item[data-filter="${option.textContent}"]`);

                if (existingFilter) {
                    option.classList.remove("selected");
                    existingFilter.remove();
                } else {
                    option.classList.add("selected");

                    let selected = document.createElement("div");
                    selected.classList.add("selected-item");
                    selected.textContent = option.textContent;
                    selected.setAttribute("data-filter", option.textContent);

                    selected.addEventListener("click", function () {
                        option.classList.remove("selected");
                        selected.remove();
                    });

                    selectedFilters.appendChild(selected);
                }
            });
        });

        document.getElementById("select-all").addEventListener("change", function () {
            const checked = this.checked;
            document.querySelectorAll(".contest-checkbox").forEach(cb => cb.checked = checked);
        });

        // ‚úÖ ÌïÑÌÑ∞ Ï†ÑÏ≤¥ ÏÇ≠Ï†ú Î≤ÑÌäº Í∏∞Îä• Ï∂îÍ∞Ä
        const clearFiltersBtn = document.getElementById("clear-filters");
        clearFiltersBtn.addEventListener("click", function () {
            selectedFilters.innerHTML = "";
            filterOptions.forEach(option => option.classList.remove("selected"));
        });

        // ‚úÖ ÏÇ≠Ï†ú Í∏∞Îä•
        var deleteButton = document.getElementById("delete-selected");
        if (deleteButton) {
            deleteButton.addEventListener("click", function () {
                var checkboxes = document.querySelectorAll(".contest-checkbox:checked");
                if (checkboxes.length === 0) {
                    alert("ÏÇ≠Ï†úÌï† Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
                    return;
                }

                checkboxes.forEach(function (checkbox) {
                    checkbox.closest("tr").remove();
                });
            });
        }
    }

</script>
</body>
</html>