<head>
    <link rel="stylesheet" th:href="@{/css/header.css}">
</head>
<div th:fragment="header">
    <header>
        <nav class="navigator">
            <div class="nav-left">
                <h3 class="site-name"><a href="/main">BOB</a></h3>
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="#" class="nav-menu">ê³µëª¨ì „</a>
                        <div class="all-dropdown-menu">
                            <div class="dropdown-section">
                                <ul>
                                    <li><a href="contest">ì „ì²´ ê³µëª¨ì „</a></li>
                                    <li><a href="#">ê³µëª¨ì „ íŒ€ ëª¨ì§‘</a></li>
                                    <li><a href="#">ê³µëª¨ì „ í™œë™</a></li>
                                    <li><a href="#">ì°œí•œ ê³µëª¨ì „</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-menu">í”„ë¡œì íŠ¸</a>
                        <div class="all-dropdown-menu">
                            <div class="dropdown-section">
                                <ul>
                                    <li><a th:href="@{/project}">í”„ë¡œì íŠ¸</a></li> <!-- âœ… ê¸°ì¡´ "project" ì œê±°í•˜ê³  ì˜¬ë°”ë¥¸ ê²½ë¡œë¡œ ë³€ê²½ -->
                                    <li><a href="bw">í”„ë¡œì íŠ¸ ìƒì„±</a></li>
                                    <li><a href="myproject">MY í”„ë¡œì íŠ¸</a></li>
                                    <li><a href="#">ì°œí•œ í”„ë¡œì íŠ¸</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-menu">êµ¬ì§</a>
                        <div class="all-dropdown-menu">
                            <div class="dropdown-section">
                                <ul>
                                    <li><a href="#">êµ¬ì¸ ê³µê³ </a></li>
                                    <li><a href="#">í¬íŠ¸í´ë¦¬ì˜¤ ëª¨ìŒë°©</a></li>
                                    <li><a href="#">ì‹ ì²­í•œ êµ¬ì§ ë‚´ì—­</a></li>
                                    <li><a href="#">ì°œí•œ ê³µê³ </a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-menu">ì´ë ¥ì„œ</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-menu">ê²Œì‹œíŒ</a>
                    </li>
                </ul>
            </div>
            <div class="nav-right">
                <div class="search-bar-container">
                    <form id="searchForm">
                        <input type="text" name="kw" id="search_kw" class="search-bar" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" th:value="${kw}">
                        <span class="search-icon"><img src="/images/search.png" alt=""></span>
                    </form>
                </div>
                <a class="chatting-icon">
                    <img src="/images/chatting.png" alt="">
                </a>
                <div class="nav-item1">
                    <a class="user-icon">
                        <img src="/images/user.png" alt="Profile Image">
                    </a>
                    <div class="all-dropdown-menu">
                        <div class="dropdown-section">
                            <ul>
                                <!-- ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ -->
                                <li th:if="${user != null}"><a href="/profile">ë‚´ ì •ë³´ / í‰ì </a></li>
                                <li th:if="${user != null}"><a href="#" class="notification-icon" id="notification-icon">ì•Œë¦¼</a><span class="notification-badge" id="notification-badge"></span></li>
                                <li th:if="${user != null}"><a href="/prohistory">ê²½ë ¥ ë‚´ì—­</a></li>
                                <li th:if="${user != null}"><a href="#">ì§€ì› í˜„í™©</a></li>
                                <li th:if="${user != null}">
                                    <form id="logoutForm" th:action="@{/logout}" method="post">
                                        <button type="submit" class="logout">ë¡œê·¸ì•„ì›ƒ</button>
                                    </form>
                                </li>

                                <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ -->
                                <li th:unless="${user != null}"><a href="/login" id="plz"><img src="/images/login.png">ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <!-- ğŸ“© ì•Œë¦¼ì°½ -->
        <form>
            <div class="notification-box" id="notification-box">
                <div class="notification-header">
                    <h3>ì•Œë¦¼</h3>
                    <button id="close-notification">&times;</button>
                </div>
                <ul id="notification-list">
                    <!-- ì•Œë¦¼ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </ul>
                <div class="notification-footer">
                    <button id="clear-all">ëª¨ë‘ ì‚­ì œ</button>
                </div>
            </div>
        </form>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const dropdownToggles = document.querySelectorAll(".dropdown-toggle");

                dropdownToggles.forEach(toggle => {
                    toggle.addEventListener("click", (e) => {
                        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë§‰ê¸°
                        const parent = toggle.parentElement;

                        // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                        document.querySelectorAll(".dropdown").forEach(dropdown => {
                            if (dropdown !== parent) {
                                dropdown.classList.remove("show");
                            }
                        });

                        // í˜„ì¬ ë“œë¡­ë‹¤ìš´ ì—´ê¸°/ë‹«ê¸°
                        parent.classList.toggle("show");
                    });
                });

                // í˜ì´ì§€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                document.addEventListener("click", (e) => {
                    if (!e.target.closest(".dropdown")) {
                        document.querySelectorAll(".dropdown").forEach(dropdown => {
                            dropdown.classList.remove("show");
                        });
                    }
                });
            });

            //ì•Œë¦¼ë¶€ë¶„
            document.addEventListener("DOMContentLoaded", function () {
                const notificationIcon = document.getElementById("notification-icon");
                const notificationBox = document.getElementById("notification-box");
                const closeNotification = document.getElementById("close-notification");
                const notificationList = document.getElementById("notification-list");
                const notificationBadge = document.getElementById("notification-badge");
                const clearAllButton = document.getElementById("clear-all");

                // ê°€ì§œ ì•Œë¦¼ ë°ì´í„° (ë°±ì—”ë“œì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ)
                let notifications = [
                    { id: 1, message: "ìƒˆë¡œìš´ ëŒ“ê¸€ì´ ë‹¬ë ¸ìŠµë‹ˆë‹¤!", link: "/comments/1" },
                    { id: 2, message: "ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!", link: "/projects/2" },
                    { id: 3, message: "ëª¨ì§‘ ë§ˆê°ì´ ì„ë°•í–ˆìŠµë‹ˆë‹¤!", link: "/projects/3" }
                ];

                // ğŸ”” ì•Œë¦¼ ëª©ë¡ ë Œë”ë§
                function renderNotifications() {
                    notificationList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
                    if (notifications.length === 0) {
                        notificationList.innerHTML = "<li class='notification-item'>ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>";
                        notificationBadge.style.display = "none"; // ì•Œë¦¼ ë°°ì§€ ìˆ¨ê¸°ê¸°
                        return;
                    }

                    notifications.forEach(notification => {
                        let item = document.createElement("li");
                        item.classList.add("notification-item");
                        item.textContent = notification.message;
                        item.onclick = function () {
                            window.location.href = notification.link; // í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™
                        };
                        notificationList.appendChild(item);
                    });

                    notificationBadge.style.display = "flex"; // ì•Œë¦¼ ë°°ì§€ ë³´ì´ê¸°
                    notificationBadge.textContent = notifications.length; // ì•Œë¦¼ ê°œìˆ˜ í‘œì‹œ
                }

                // ğŸ”¥ ì•Œë¦¼ ì•„ì´ì½˜ í´ë¦­ ì‹œ ì•Œë¦¼ì°½ í‘œì‹œ/ìˆ¨ê¹€
                notificationIcon.addEventListener("click", function () {
                    notificationBox.style.display = (notificationBox.style.display === "none" || notificationBox.style.display === "") ? "flex" : "none";
                });

                // âŒ ì•Œë¦¼ì°½ ë‹«ê¸° ë²„íŠ¼
                closeNotification.addEventListener("click", function () {
                    notificationBox.style.display = "none";
                });

                // ğŸ—‘ "ëª¨ë‘ ì‚­ì œ" ë²„íŠ¼
                clearAllButton.addEventListener("click", function () {
                    notifications = [];
                    renderNotifications();
                });

                // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•Œë¦¼ ë Œë”ë§
                renderNotifications();
            });
        </script>
    </header>
</div>
