<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공모전 공고 작성</title>
    <link rel="stylesheet" href="/css/ad_newcontest.css">
</head>
<body>

<!-- 공모전 등록 폼 -->
<section class="contest-form">
    <h2>공모전 등록</h2>

    <form action="/contest/create" method="post" enctype="multipart/form-data">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="form-container">
            <!-- 공모전 포스터 업로드 -->
            <div class="poster-upload">
                <input type="file" id="poster-input" name="imageFile" accept="image/*">
                <img id="poster-preview" src="/images/placeholder.png" alt="공모전 포스터를 삽입해주세요.">
            </div>


            <!-- 공모전 정보 입력 -->
            <table class="contest-table">
                <tr>
                    <th>공모전명</th>
                    <td><input type="text" id="contest-title" name="title" placeholder="공모전명을 입력하세요"></td>
                </tr>
                <tr>
                    <th>주최/주관</th>
                    <td><input type="text" id="contest-host" name="organizer"></td>
                </tr>
                <tr>
                    <th>대표분야</th>
                    <td>
                        <select id="fieldSelect" name="category">
                            <option disabled selected>분야를 선택하세요</option>
                            <option>프론트 / 웹, 앱 디자인</option>
                            <option>백 / 웹, 앱 개발</option>
                            <option value="custom">직접 입력</option>
                        </select>
                        <input type="text" id="customFieldInput" name="categoryCustom" placeholder="직접 분야를 입력해주세요." style="display: none; margin-top: 10px;" />
                    </td>
                </tr>
                <tr>
                    <th>참가대상</th>
                    <td><input type="text" id="contest-target" name="target"></td>
                </tr>
                <tr>
                    <th>대회지역</th>
                    <td><input type="text" id="contest-region" name="region"></td>
                </tr>
                <tr>
                    <th>진행기간</th>
                    <td>
                        <input type="date" id="contest-start" name="startDate"> ~
                        <input type="date" id="contest-end" name="endDate">
                    </td>
                </tr>
                <tr>
                    <th>심사기관</th>
                    <td><input type="text" id="contest-judge" name="judge"></td>
                </tr>
                <tr>
                    <th>시상내역</th>
                    <td><input type="text" id="contest-prize" name="awardDetails"></td>
                </tr>
                <tr>
                    <th>웹사이트</th>
                    <td><input type="text" name="applicationMethod"
                               onblur="prependHttp(this)"
                               placeholder="웹사이트 링크를 첨부해주세요."></td>
                </tr>
            </table>
        </div>

        <!-- 상세 내용 입력 -->
        <div class="details-container">
            <h3>상세 내용</h3>
            <textarea id="contest-details" name="description" placeholder="상세 내용을 입력하세요"></textarea>
        </div>

        <!-- 등록/취소 버튼 -->
        <div class="button-container">
            <button type="submit" class="register-btn" id="register-btn">등록하기</button>
            <button class="cancel-btn" id="cancel-btn">취소하기</button>
        </div>
    </form>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const posterInput = document.getElementById("poster-input");
        const posterPreview = document.getElementById("poster-preview");
        const registerBtn = document.getElementById("register-btn");
        const cancelBtn = document.getElementById("cancel-btn");

        // 포스터 이미지 업로드 및 미리보기 기능
        posterInput.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    posterPreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // 등록 버튼 클릭 시 데이터 콘솔 출력 (백엔드 연동 시 서버로 전송 가능)
        registerBtn.addEventListener("click", function () {
            const contestData = {
                title: document.getElementById("contest-title").value,
                host: document.getElementById("contest-host").value,
                field: document.getElementById("contest-field").value,
                target: document.getElementById("contest-target").value,
                region: document.getElementById("contest-region").value,
                startDate: document.getElementById("contest-start").value,
                endDate: document.getElementById("contest-end").value,
                judge: document.getElementById("contest-judge").value,
                prize: document.getElementById("contest-prize").value,
                method: document.getElementById("contest-method").value,
                details: document.getElementById("contest-details").value
            };

            console.log("공모전 데이터:", contestData);
            alert("공모전이 등록되었습니다!");
        });

        // 취소 버튼 클릭 시 입력값 초기화
        cancelBtn.addEventListener("click", function () {
            if (confirm("입력한 내용을 모두 초기화하시겠습니까?")) {
                document.querySelector("form").reset();
                posterPreview.src = "/images/placeholder.png";
            }
        });

        function prependHttp(input) {
            if (input.value && !input.value.startsWith("http://") && !input.value.startsWith("https://")) {
                input.value = "https://" + input.value;
            }
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        const fieldSelect = document.getElementById("fieldSelect");
        const customInput = document.getElementById("customFieldInput");

        fieldSelect.addEventListener("change", function () {
            if (fieldSelect.value === "custom") {
                customInput.style.display = "block"; // ✅ 직접 입력 선택 시 보이게
            } else {
                customInput.style.display = "none"; // 다른 항목 선택 시 숨김
                customInput.value = ""; // 입력된 내용도 초기화
            }
        });

        // 아래는 기존 코드 (예: 확인 버튼 클릭 시 hidden input 추가)
        document.getElementById('confirmYes').addEventListener('click', function () {
            if (fieldSelect.value === 'custom' && customInput.value.trim() !== '') {
                const hiddenCategoryInput = document.createElement("input");
                hiddenCategoryInput.type = "hidden";
                hiddenCategoryInput.name = "customCategory";
                hiddenCategoryInput.value = customInput.value.trim();

                document.querySelector(".contest-form").appendChild(hiddenCategoryInput);
            }
        });
    });
</script>
</body>
</html>
