<!DOCTYPE html>
<html lang="ko">
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공모전 주최 요청</title>
    <link rel="stylesheet" href="/css/ad_contest_request.css">
</head>
<body>

<!-- 공모전 요청 상세 -->
<section class="contest-request">
    <h2>공모전 주최 요청</h2>

    <div class="form-container">
        <!-- 공모전 포스터 (읽기 전용) -->
        <div class="poster-preview">
            <img id="poster-img" th:src="@{${contest.imageUrl}}" alt="공모전 포스터">
        </div>

        <!-- 공모전 정보 -->
        <table class="contest-table">
            <tr>
                <th>공모전명</th>
                <td th:text="${contest.title}"></td>
            </tr>
            <tr>
                <th>주최/주관</th>
                <td th:text="${contest.organizer}"></td>
            </tr>
            <tr>
                <th>대표분야</th>
                <td th:text="${contest.category}"></td>
            </tr>
            <tr>
                <th>참가대상</th>
                <td th:text="${contest.target}"></td>
            </tr>
            <tr>
                <th>대회지역</th>
                <td th:text="${contest.region}"></td>
            </tr>
            <tr>
                <th>진행기간</th>
                <td>
                    <span th:text="${#temporals.format(contest.startDate, 'yyyy.MM.dd')}"></span> ~
                    <span th:text="${#temporals.format(contest.endDate, 'yyyy.MM.dd')}"></span>
                </td>
            </tr>
            <tr>
                <th>심사기관</th>
                <td th:text="${contest.judge}"></td>
            </tr>
            <tr>
                <th>시상내역</th>
                <td th:text="${contest.awardDetails}"></td>
            </tr>
            <tr>
                <th>주최 신청 날짜</th>
                <td th:text="${#temporals.format(contest.createdAt, 'yyyy.MM.dd')}"></td>
            </tr>
        </table>
    </div>

    <!-- 공모전 설명 -->
    <div class="details-container">
        <h3>공모전 설명</h3>
        <p id="contest-details" th:text="${contest.description}"></p>
    </div>

    <!-- 승인/거절 버튼 -->
    <div class="button-container">
        <form method="post" action="/admin/contest/approve" style="display: inline;">
            <input type="hidden" name="id" th:value="${contest.id}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button class="approve-btn" type="submit" onclick="return confirm('승인하시겠습니까?')">승인</button>
        </form>

        <form method="post" action="/admin/contest/reject" style="display: inline;">
            <input type="hidden" name="id" th:value="${contest.id}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button class="reject-btn" type="submit" onclick="return confirm('거절하시겠습니까?')">거절</button>
        </form>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const approveBtn = document.getElementById("approve-btn");
        const rejectBtn = document.getElementById("reject-btn");
        const contestId = /*[[${contest.id}]]*/ 0; // 타임리프에서 공모전 ID 주입

        // 승인
        approveBtn.addEventListener("click", function () {
            if (confirm("이 공모전을 승인하시겠습니까?")) {
                fetch("/admin/contest/approve", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: new URLSearchParams({ id: contestId })
                }).then(() => {
                    alert("공모전이 승인되었습니다.");
                    window.location.href = "/adconlist"; // 목록으로 이동
                });
            }
        });

        // 거절
        rejectBtn.addEventListener("click", function () {
            if (confirm("이 공모전을 거절하시겠습니까?")) {
                fetch("/admin/contest/reject", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: new URLSearchParams({ id: contestId })
                }).then(() => {
                    alert("공모전이 거절되었습니다.");
                    window.location.href = "/adconlist"; // 목록으로 이동
                });
            }
        });
    });
</script>


</body>
</html>
