  <!DOCTYPE html>
  <html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 수정</title>
    <link rel="stylesheet" href="/css/newproject.css">
    <link rel="stylesheet" th:href="@{/css/header.css}">
  </head>
  <body>
  <!-- header -->
  <div th:insert="~{header :: header}"></div>

  <main class="main-content">
    <section class="project-create">
      <h1>프로젝트 수정</h1>
      <hr>
      <form id="editForm" th:action="@{'/postproject/' + ${project.id} + '/edit'}" method="post" class="project-form">
        <!-- CSRF 토큰 추가 -->
        <input type="hidden" name="_csrf" th:value="${_csrf.token}">

        <label for="start-date">진행 일정</label>
        <div class="date-inputs">
          <input type="date" id="start-date" name="start-date" th:value="${project.startDate}">
          <span>~</span>
          <input type="date" id="end-date" name="end-date" th:value="${project.endDate}">
        </div>

        <div class="form-group">
          <label for="recruit-start-date">모집 일정</label>
          <div class="date-inputs">
            <input type="date" id="recruit-start-date" name="recruit-start-date" th:value="${project.recruitmentStartDate}">
            <span>~</span>
            <input type="date" id="recruit-end-date" name="recruit-end-date" th:value="${project.recruitmentEndDate}">
          </div>
        </div>

        <div class="form-group">
          <label for="recruitment">모집 인원</label>
          <select id="recruitment" name="recruitment">
            <option value="0" th:selected="${project.recruitmentCount == 0}">0명</option>
            <option value="1" th:selected="${project.recruitmentCount == 1}">1명</option>
            <option value="2" th:selected="${project.recruitmentCount == 2}">2명</option>
            <option value="3" th:selected="${project.recruitmentCount == 3}">3명</option>
            <option value="plus">기타</option>
          </select>
          <div id="custom-input-group" style="display: none; display: flex; align-items: center;">
            <input type="text" id="custom-recruitment" name="custom-recruitment" placeholder="직접 입력">
            <p style="margin-left: 5px;">명</p>
          </div>
        </div>

        <div class="form-group">
          <label for="project-name">프로젝트 주제</label> <!-- 'for' 값을 'project-name'으로 수정 -->
          <input type="text" id="project-name" name="project-name" th:value="${project.title}" placeholder="프로젝트명을 입력하세요.">
        </div>

        <div class="form-group">
          <label for="project-goal">프로젝트 목표</label>
          <textarea id="project-goal" name="project-goal" th:text="${project.goal}" placeholder="프로젝트 목표를 입력하세요."></textarea>
        </div>

        <div class="form-group">
          <label for="project-description">프로젝트 내용</label>
          <textarea id="project-description" name="project-description" th:text="${project.description}" placeholder="프로젝트 내용을 입력하세요."></textarea>
        </div>

        <div class="btn">
          <button type="submit" class="submit-btn">수정</button>
          <button type="button" class="cancel-button">
            <a href="/project" class="ynbw">취소</a>
          </button>
        </div>
      </form>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("editForm");

      form.addEventListener("submit", function (event) {
        event.preventDefault(); // 기본 제출 동작 방지

        let projectId = window.location.pathname.split("/")[2];
        if (isNaN(projectId)) {
          alert("잘못된 프로젝트 ID입니다.");
          return;
        }

        let recruitmentValue = document.getElementById("recruitment").value;
        if (recruitmentValue === "plus") {
          recruitmentValue = document.getElementById("custom-recruitment").value;
        }

        // FormData 사용
        const formData = new FormData(form);  // 기존 form 요소에서 데이터 전송
        formData.append("project-id", projectId);  // 필요시 추가 데이터

        // 전송될 데이터 로그
        console.log("전송될 데이터: ");
        formData.forEach((value, key) => {
          console.log(key + ": " + value);
        });

        fetch(`/postproject/${projectId}/edit`, {
          method: "POST",
          body: formData  // URL 인코딩된 데이터 대신 FormData 객체 사용
        })
                .then(response => {
                  if (response.ok) {
                    alert("프로젝트가 성공적으로 수정되었습니다!");
                    window.location.href = `/postproject/${projectId}`;  // 수정 후 상세보기 페이지로 리디렉션
                  } else {
                    alert("프로젝트 수정에 실패했습니다.");
                  }
                })
                .catch(error => {
                  console.error("수정 요청 실패:", error);
                  alert("수정 요청 중 오류가 발생했습니다.");
                });
      });
    });

  </script>

  </body>
  </html>
